<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Èõô‰∫∫Ë≤™ÂêÉËõáÈÅäÊà≤</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 2.5em;
        }
        
        #main-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
            max-width: 1000px;
            gap: 20px;
        }
        
        #game-container {
            flex-grow: 1;
            max-width: 520px;
            border: 4px solid #3498db;
            box-shadow: 0 0 25px rgba(52, 152, 219, 0.5);
            border-radius: 15px;
            padding: 20px;
            background: #fff;
            text-align: center;
            box-sizing: border-box;
        }
        
        canvas {
            background-color: #2c3e50;
            display: block;
            border: 2px solid #34495e;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
            margin: 0 auto;
        }
        
        .player-info-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 200px;
            box-sizing: border-box;
            text-align: center;
        }
        
        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            font-weight: bold;
        }
        
        #player1-avatar { 
            border-color: #f1c40f; 
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }
        
        #player2-avatar { 
            border-color: #e74c3c; 
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .player-score {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        #score-player1 { color: #f1c40f; }
        #score-player2 { color: #e74c3c; }
        
        .player-name {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 15px;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            width: 100%;
        }

        .control-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .control-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 150px;
            margin-top: 10px;
        }
        
        .control-button {
            background: linear-gradient(135deg, #bdc3c7, #95a5a6);
            color: #2c3e50;
            border: none;
            padding: 10px;
            font-size: 1.2em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            font-weight: bold;
        }
        
        .control-button:hover {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
        }
        
        .control-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .control-button.up { grid-column: 2; }
        .control-button.left { grid-column: 1; grid-row: 2; }
        .control-button.right { grid-column: 3; grid-row: 2; }
        .control-button.down { grid-column: 2; grid-row: 3; }
        
        .game-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .game-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            font-weight: bold;
        }
        
        .game-button:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        .game-button:active {
            transform: translateY(0);
        }
        
        .game-button.pause {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .game-button.pause:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }
        
        .game-status {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            color: #2c3e50;
        }
        
        .winner-announcement {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }
        
        .punishment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .punishment-content {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.5s ease;
            position: relative;
        }
        
        .punishment-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .punishment-text {
            font-size: 1.5em;
            margin-bottom: 30px;
            line-height: 1.4;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .punishment-close {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(243, 156, 18, 0.3);
            font-weight: bold;
        }
        
        .punishment-close:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(243, 156, 18, 0.4);
        }
        
        .punishment-emoji {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @media (max-width: 768px) {
            #main-container {
                flex-direction: column;
                align-items: center;
            }
            
            .player-info-panel {
                width: 100%;
                max-width: 300px;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .punishment-content {
                padding: 30px 20px;
            }
            
            .punishment-title {
                font-size: 2em;
            }
            
            .punishment-text {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <h1>üêç Èõô‰∫∫Ë≤™ÂêÉËõáÂ§ßÊà∞ üêç</h1>
    
    <div id="main-container">
        <div class="player-info-panel">
            <div id="player1-avatar" class="player-avatar">1</div>
            <div class="player-name">Áé©ÂÆ∂‰∏Ä</div>
            <div id="score-player1" class="player-score">0</div>
            <div class="control-panel">
                <div style="font-size: 0.9em; margin-bottom: 5px; color: #7f8c8d;">WASD ÊéßÂà∂</div>
                <div class="control-pad">
                    <button class="control-button up" data-player="1" data-direction="up">‚Üë</button>
                    <button class="control-button left" data-player="1" data-direction="left">‚Üê</button>
                    <button class="control-button right" data-player="1" data-direction="right">‚Üí</button>
                    <button class="control-button down" data-player="1" data-direction="down">‚Üì</button>
                </div>
            </div>
        </div>
        
        <div id="game-container">
            <canvas id="gameCanvas" width="480" height="480"></canvas>
            <div class="game-status" id="gameStatus">Ê∫ñÂÇôÈñãÂßãÈÅäÊà≤ÔºÅ</div>
            <div class="game-controls">
                <button class="game-button" id="startBtn">ÈñãÂßãÈÅäÊà≤</button>
                <button class="game-button pause" id="pauseBtn">Êö´ÂÅú</button>
                <button class="game-button" id="resetBtn">ÈáçÊñ∞ÈñãÂßã</button>
            </div>
            
            <!-- È£üÁâ©Ë™™Êòé -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 10px 0; font-size: 0.9em;">
                <div style="font-weight: bold; margin-bottom: 8px; color: #2c3e50;">üçé È£üÁâ©ÊïàÊûúË™™ÊòéÔºö</div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    <span>üçé ËòãÊûú +1ÂàÜ</span>
                    <span>üçØ ËúÇËúú +3ÂàÜ</span>
                    <span>‚ö° ÈñÉÈõª +2ÂàÜ Âä†ÈÄü</span>
                    <span>üçá Ëë°ËêÑ +1ÂàÜ Á∏ÆÂ∞è</span>
                    <span>üíé ÈëΩÁü≥ +5ÂàÜ</span>
                </div>
            </div>
            
            <div id="winnerDisplay"></div>
        </div>
        
        <div class="player-info-panel">
            <div id="player2-avatar" class="player-avatar">2</div>
            <div class="player-name">Áé©ÂÆ∂‰∫å</div>
            <div id="score-player2" class="player-score">0</div>
            <div class="control-panel">
                <div style="font-size: 0.9em; margin-bottom: 5px; color: #7f8c8d;">ÊñπÂêëÈçµÊéßÂà∂</div>
                <div class="control-pad">
                    <button class="control-button up" data-player="2" data-direction="up">‚Üë</button>
                    <button class="control-button left" data-player="2" data-direction="left">‚Üê</button>
                    <button class="control-button right" data-player="2" data-direction="right">‚Üí</button>
                    <button class="control-button down" data-player="2" data-direction="down">‚Üì</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Êá≤ÁΩ∞ÂΩàÁ™ó -->
    <div id="punishmentModal" class="punishment-modal">
        <div class="punishment-content">
            <span id="punishmentEmoji" class="punishment-emoji">üòà</span>
            <div class="punishment-title">Êá≤ÁΩ∞ÊôÇÈñìÔºÅ</div>
            <div id="punishmentText" class="punishment-text">
                ‰Ω†Ëº∏‰∫ÜÔºÅÊ∫ñÂÇôÊé•ÂèóÊá≤ÁΩ∞ÂêßÔºÅ
            </div>
            <button class="punishment-close" onclick="closePunishmentModal()">Êé•ÂèóÊá≤ÁΩ∞</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const gameStatus = document.getElementById('gameStatus');
        const winnerDisplay = document.getElementById('winnerDisplay');
        const scorePlayer1 = document.getElementById('score-player1');
        const scorePlayer2 = document.getElementById('score-player2');

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let gameRunning = false;
        let gamePaused = false;
        let gameLoop;

        // ÈÅäÊà≤ÁãÄÊÖã
        let player1 = {
            x: 10,
            y: 10,
            dx: 0,
            dy: 0,
            tail: [],
            score: 0,
            color: '#f1c40f'
        };

        let player2 = {
            x: 15,
            y: 15,
            dx: 0,
            dy: 0,
            tail: [],
            score: 0,
            color: '#e74c3c'
        };

        // È£üÁâ©Á≥ªÁµ±
        let foods = [];
        let obstacles = [];
        
        const foodTypes = [
            { type: 'normal', color: '#2ecc71', points: 1, emoji: 'üçé', effect: 'normal' },
            { type: 'golden', color: '#f1c40f', points: 3, emoji: 'üçØ', effect: 'golden' },
            { type: 'speed', color: '#e67e22', points: 2, emoji: '‚ö°', effect: 'speed' },
            { type: 'shrink', color: '#9b59b6', points: 1, emoji: 'üçá', effect: 'shrink' },
            { type: 'bonus', color: '#1abc9c', points: 5, emoji: 'üíé', effect: 'bonus' }
        ];

        // Áé©ÂÆ∂ÊïàÊûúÁãÄÊÖã
        let playerEffects = {
            player1: { speed: false, speedTimer: 0 },
            player2: { speed: false, speedTimer: 0 }
        };

        // Êá≤ÁΩ∞Á≥ªÁµ±
        const punishments = [
            {
                emoji: "ü§°",
                text: "Âú®‰∏ã‰∏ÄÂ±ÄÈÅäÊà≤‰∏≠Ôºå‰Ω†ÂøÖÈ†àÁî®Áõ∏ÂèçÁöÑÊñπÂêëÈçµÊìç‰ΩúÔºÅÔºà‰∏äËÆä‰∏ãÔºåÂ∑¶ËÆäÂè≥Ôºâ"
            },
            {
                emoji: "üêå",
                text: "ÂÅö10ÂÄãÊ∑±Ëπ≤ÔºÅÊÖ¢ÊÖ¢‰æÜÔºå‰∏çË¶ÅÂÅ∑Êá∂Âì¶ÔΩû"
            },
            {
                emoji: "üé≠",
                text: "Áî®ÊúÄË™áÂºµÁöÑË°®ÊÉÖÂíåËÅ≤Èü≥Ë™™Ôºö„ÄåÊàëÊòØË≤™ÂêÉËõáËèúÈ≥•ÔºÅ„Äç"
            },
            {
                emoji: "üï∫",
                text: "Ë∑≥‰∏ÄÊÆµ30ÁßíÁöÑÂ∞¨ËàûÔºÅË∂äÂ∞∑Â∞¨Ë∂äÂ•ΩÔºÅ"
            },
            {
                emoji: "üé§",
                text: "Âî±‰∏ÄÈ¶ñÂÖíÊ≠åÔºåË¶ÅÊúâÊÑüÊÉÖÂú∞Âî±ÂÆåÊï¥È¶ñÔºÅ"
            },
            {
                emoji: "ü§™",
                text: "Áî®ËàåÈ†≠Á¢∞ÈºªÂ≠ê10Ê¨°ÔºåÁ¢∞‰∏çÂà∞Â∞±ÂÅöÈ¨ºËáâ10ÁßíÔºÅ"
            },
            {
                emoji: "üèÉ",
                text: "ÂéüÂú∞Ë∑ëÊ≠•1ÂàÜÈêòÔºåË¶ÅÈ´òÊä¨ËÖøÂì¶ÔºÅ"
            },
            {
                emoji: "üé®",
                text: "Áî®ÈùûÊÖ£Áî®ÊâãÂØ´‰∏ã„ÄåÊàëÊúÉÊõ¥Âä™ÂäõÁ∑¥ÁøíË≤™ÂêÉËõá„Äç"
            },
            {
                emoji: "ü§ñ",
                text: "Áî®Ê©üÂô®‰∫∫ÁöÑËÅ≤Èü≥ÂíåÂãï‰ΩúË™™Ë©±30ÁßíÔºÅ"
            },
            {
                emoji: "üçé",
                text: "‰∏ã‰∏ÄÂ±ÄÈÅäÊà≤ÊôÇÔºåÊØèÊ¨°ÂêÉÂà∞È£üÁâ©ÈÉΩË¶ÅË™™„ÄåÂ•ΩÂêÉÔºÅ„Äç"
            },
            {
                emoji: "üòµ",
                text: "ÈñâÁúºËΩâÂúà5ÂúàÔºåÁÑ∂ÂæåË©¶ËëóËµ∞Áõ¥Á∑öÂà∞Â∞çÈù¢ÔºÅ"
            },
            {
                emoji: "üé™",
                text: "Ë°®Êºî‰∏ÄÂÄã‰Ω†ÊúÄÊãøÊâãÁöÑÊâçËóùÔºåËá≥Â∞ë30ÁßíÔºÅ"
            },
            {
                emoji: "ü¶ò",
                text: "ÂÉèË¢ãÈº†‰∏ÄÊ®£Ë∑≥Ë∫ç10Ê¨°ÔºåË¶ÅÊúâË¢ãÈº†ÁöÑÂßøÂã¢ÔºÅ"
            },
            {
                emoji: "üéØ",
                text: "Áî®ÁúºÁ•û„ÄåÊÆ∫Ê≠ª„ÄçÂ∞çÊâãÔºå‰øùÊåÅÂÖáÁã†Ë°®ÊÉÖ10Áßí‰∏çËÉΩÁ¨ëÔºÅ"
            },
            {
                emoji: "üßò",
                text: "‰øùÊåÅÁëú‰ºΩÂßøÂã¢1ÂàÜÈêòÔºåÈÅ∏‰∏ÄÂÄã‰Ω†Ë¶∫ÂæóÊúÄÈõ£ÁöÑÔºÅ"
            }
        ];

        function getRandomPunishment() {
            return punishments[Math.floor(Math.random() * punishments.length)];
        }

        // ÁîüÊàêÈ£üÁâ©
        function generateFood() {
            // Ê∏ÖÁ©∫ÁèæÊúâÈ£üÁâ©
            foods = [];
            
            // ÁîüÊàê2-4ÂÄãÈ£üÁâ©
            const foodCount = Math.floor(Math.random() * 3) + 2;
            
            for (let i = 0; i < foodCount; i++) {
                let validPosition = false;
                let attempts = 0;
                
                while (!validPosition && attempts < 50) {
                    const x = Math.floor(Math.random() * tileCount);
                    const y = Math.floor(Math.random() * tileCount);
                    
                    validPosition = true;
                    attempts++;
                    
                    // Ê™¢Êü•ÊòØÂê¶ËàáËõáË∫´ÈáçÁñä
                    if ((x === player1.x && y === player1.y) || (x === player2.x && y === player2.y)) {
                        validPosition = false;
                        continue;
                    }
                    
                    for (let segment of player1.tail) {
                        if (x === segment.x && y === segment.y) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    if (!validPosition) continue;
                    
                    for (let segment of player2.tail) {
                        if (x === segment.x && y === segment.y) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    if (!validPosition) continue;
                    
                    // Ê™¢Êü•ÊòØÂê¶ËàáÈöúÁ§ôÁâ©ÈáçÁñä
                    for (let obstacle of obstacles) {
                        if (x === obstacle.x && y === obstacle.y) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    if (!validPosition) continue;
                    
                    // Ê™¢Êü•ÊòØÂê¶ËàáÂÖ∂‰ªñÈ£üÁâ©ÈáçÁñä
                    for (let food of foods) {
                        if (x === food.x && y === food.y) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    if (validPosition) {
                        // ÈÅ∏ÊìáÈ£üÁâ©È°ûÂûãÔºàÊôÆÈÄöÈ£üÁâ©Ê©üÁéáËºÉÈ´òÔºâ
                        let foodType;
                        const rand = Math.random();
                        if (rand < 0.5) {
                            foodType = foodTypes[0]; // ÊôÆÈÄöÈ£üÁâ©
                        } else if (rand < 0.7) {
                            foodType = foodTypes[1]; // ÈªÉÈáëÈ£üÁâ©
                        } else if (rand < 0.85) {
                            foodType = foodTypes[2]; // ÈÄüÂ∫¶È£üÁâ©
                        } else if (rand < 0.95) {
                            foodType = foodTypes[3]; // Á∏ÆÂ∞èÈ£üÁâ©
                        } else {
                            foodType = foodTypes[4]; // ÁçéÂãµÈ£üÁâ©
                        }
                        
                        foods.push({
                            x: x,
                            y: y,
                            type: foodType.type,
                            color: foodType.color,
                            points: foodType.points,
                            emoji: foodType.emoji,
                            effect: foodType.effect
                        });
                    }
                }
            }
        }

        // ÁîüÊàêÈöúÁ§ôÁâ©
        function generateObstacles() {
            obstacles = [];
            
            // ÁîüÊàê5-8ÂÄãÈöúÁ§ôÁâ©
            const obstacleCount = Math.floor(Math.random() * 4) + 5;
            
            for (let i = 0; i < obstacleCount; i++) {
                let validPosition = false;
                let attempts = 0;
                
                while (!validPosition && attempts < 50) {
                    const x = Math.floor(Math.random() * tileCount);
                    const y = Math.floor(Math.random() * tileCount);
                    
                    validPosition = true;
                    attempts++;
                    
                    // ÈÅøÂÖçÂú®Áé©ÂÆ∂Ëµ∑Âßã‰ΩçÁΩÆÈôÑËøëÁîüÊàê
                    if ((Math.abs(x - 10) < 3 && Math.abs(y - 10) < 3) ||
                        (Math.abs(x - 15) < 3 && Math.abs(y - 15) < 3)) {
                        validPosition = false;
                        continue;
                    }
                    
                    // Ê™¢Êü•ÊòØÂê¶ËàáÂÖ∂‰ªñÈöúÁ§ôÁâ©ÈáçÁñä
                    for (let obstacle of obstacles) {
                        if (x === obstacle.x && y === obstacle.y) {
                            validPosition = false;
                            break;
                        }
                    }
                    
                    if (validPosition) {
                        obstacles.push({ x: x, y: y });
                    }
                }
            }
        }

        function showPunishmentModal(loser) {
            const punishment = getRandomPunishment();
            const modal = document.getElementById('punishmentModal');
            const emoji = document.getElementById('punishmentEmoji');
            const text = document.getElementById('punishmentText');
            
            emoji.textContent = punishment.emoji;
            text.textContent = `${loser}Ëº∏‰∫ÜÔºÅ${punishment.text}`;
            
            modal.style.display = 'flex';
            
            // Ê∑ªÂä†ÈªûÊìäÂ§ñÈÉ®ÈóúÈñâÂäüËÉΩ
            modal.onclick = function(e) {
                if (e.target === modal) {
                    closePunishmentModal();
                }
            };
        }

        function closePunishmentModal() {
            const modal = document.getElementById('punishmentModal');
            modal.style.display = 'none';
        }

        // Áπ™Ë£ΩÈÅäÊà≤
        function drawGame() {
            // Ê∏ÖÈô§Áï´Â∏É
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Áπ™Ë£ΩÁ∂≤Ê†º
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 1;
            for (let i = 0; i <= tileCount; i++) {
                ctx.beginPath();
                ctx.moveTo(i * gridSize, 0);
                ctx.lineTo(i * gridSize, canvas.height);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i * gridSize);
                ctx.lineTo(canvas.width, i * gridSize);
                ctx.stroke();
            }

            // Áπ™Ë£ΩÈöúÁ§ôÁâ©
            ctx.fillStyle = '#95a5a6';
            ctx.shadowColor = '#7f8c8d';
            ctx.shadowBlur = 5;
            for (let obstacle of obstacles) {
                ctx.fillRect(obstacle.x * gridSize + 1, obstacle.y * gridSize + 1, gridSize - 2, gridSize - 2);
                
                // Áπ™Ë£ΩÈöúÁ§ôÁâ©Á¥ãÁêÜ
                ctx.fillStyle = '#7f8c8d';
                ctx.fillRect(obstacle.x * gridSize + 3, obstacle.y * gridSize + 3, gridSize - 6, gridSize - 6);
                ctx.fillStyle = '#95a5a6';
            }
            ctx.shadowBlur = 0;

            // Áπ™Ë£ΩÈ£üÁâ©
            for (let food of foods) {
                ctx.fillStyle = food.color;
                ctx.shadowColor = food.color;
                ctx.shadowBlur = 8;
                
                // Áπ™Ë£ΩÈ£üÁâ©ËÉåÊôØ
                ctx.fillRect(food.x * gridSize + 2, food.y * gridSize + 2, gridSize - 4, gridSize - 4);
                
                // Áπ™Ë£ΩÈ£üÁâ©Ë°®ÊÉÖÁ¨¶Ëôü
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#fff';
                ctx.font = `${gridSize - 6}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(
                    food.emoji, 
                    food.x * gridSize + gridSize / 2, 
                    food.y * gridSize + gridSize / 2
                );
            }

            // Áπ™Ë£ΩÁé©ÂÆ∂1
            drawSnake(player1, playerEffects.player1.speed);
            
            // Áπ™Ë£ΩÁé©ÂÆ∂2
            drawSnake(player2, playerEffects.player2.speed);
        }

        function drawSnake(player, hasSpeedEffect) {
            ctx.fillStyle = player.color;
            ctx.shadowColor = player.color;
            ctx.shadowBlur = hasSpeedEffect ? 10 : 5;
            
            // Áπ™Ë£ΩËõáË∫´
            for (let segment of player.tail) {
                ctx.fillRect(segment.x * gridSize + 1, segment.y * gridSize + 1, gridSize - 2, gridSize - 2);
            }
            
            // Áπ™Ë£ΩËõáÈ†≠ÔºàÂ¶ÇÊûúÊúâÈÄüÂ∫¶ÊïàÊûúÂâáÈñÉÁàçÔºâ
            if (hasSpeedEffect) {
                ctx.fillStyle = Math.random() > 0.5 ? player.color : '#fff';
            }
            ctx.fillRect(player.x * gridSize + 1, player.y * gridSize + 1, gridSize - 2, gridSize - 2);
            ctx.shadowBlur = 0;
        }

        function updateGame() {
            if (!gameRunning || gamePaused) return;

            // Êõ¥Êñ∞Áé©ÂÆ∂ÊïàÊûúË®àÊôÇÂô®
            updatePlayerEffects();

            // ÁßªÂãïÁé©ÂÆ∂1
            movePlayer(player1, 'player1');
            
            // ÁßªÂãïÁé©ÂÆ∂2
            movePlayer(player2, 'player2');

            // Ê™¢Êü•Á¢∞Êíû
            checkCollisions();

            // Êõ¥Êñ∞ÂàÜÊï∏È°ØÁ§∫
            scorePlayer1.textContent = player1.score;
            scorePlayer2.textContent = player2.score;

            drawGame();
        }

        function updatePlayerEffects() {
            // Êõ¥Êñ∞Áé©ÂÆ∂1ÈÄüÂ∫¶ÊïàÊûú
            if (playerEffects.player1.speed) {
                playerEffects.player1.speedTimer--;
                if (playerEffects.player1.speedTimer <= 0) {
                    playerEffects.player1.speed = false;
                }
            }
            
            // Êõ¥Êñ∞Áé©ÂÆ∂2ÈÄüÂ∫¶ÊïàÊûú
            if (playerEffects.player2.speed) {
                playerEffects.player2.speedTimer--;
                if (playerEffects.player2.speedTimer <= 0) {
                    playerEffects.player2.speed = false;
                }
            }
        }

        function movePlayer(player, playerKey) {
            // Ê∑ªÂä†Áï∂Ââç‰ΩçÁΩÆÂà∞Â∞æÂ∑¥
            player.tail.push({x: player.x, y: player.y});

            // ÁßªÂãïÈ†≠ÈÉ®
            player.x += player.dx;
            player.y += player.dy;

            // ÈÇäÁïåÊ™¢Êü•
            if (player.x < 0) player.x = tileCount - 1;
            if (player.x >= tileCount) player.x = 0;
            if (player.y < 0) player.y = tileCount - 1;
            if (player.y >= tileCount) player.y = 0;

            // Ê™¢Êü•ÊòØÂê¶ÂêÉÂà∞È£üÁâ©
            let ateFood = false;
            for (let i = foods.length - 1; i >= 0; i--) {
                const food = foods[i];
                if (player.x === food.x && player.y === food.y) {
                    ateFood = true;
                    player.score += food.points;
                    
                    // ÊáâÁî®È£üÁâ©ÊïàÊûú
                    applyFoodEffect(player, playerKey, food.effect);
                    
                    // ÁßªÈô§Ë¢´ÂêÉÊéâÁöÑÈ£üÁâ©
                    foods.splice(i, 1);
                    
                    // Â¶ÇÊûúÊâÄÊúâÈ£üÁâ©ÈÉΩË¢´ÂêÉÂÆåÔºåÁîüÊàêÊñ∞ÁöÑÈ£üÁâ©
                    if (foods.length === 0) {
                        generateFood();
                    }
                    break;
                }
            }
            
            if (!ateFood) {
                // ÁßªÈô§Â∞æÂ∑¥ÊúÄÂæå‰∏ÄÊÆµ
                player.tail.shift();
            }
        }

        function applyFoodEffect(player, playerKey, effect) {
            switch (effect) {
                case 'speed':
                    playerEffects[playerKey].speed = true;
                    playerEffects[playerKey].speedTimer = 50; // ÊåÅÁ∫åÁ¥Ñ5Áßí
                    break;
                case 'shrink':
                    // Á∏ÆÂ∞èËõáË∫´ÔºàÁßªÈô§ÊúÄÂæåÂÖ©ÊÆµÔºâ
                    if (player.tail.length > 2) {
                        player.tail.splice(0, 2);
                    }
                    break;
                case 'golden':
                case 'bonus':
                case 'normal':
                default:
                    // ÈÄô‰∫õÈ£üÁâ©Âè™Â¢ûÂä†ÂàÜÊï∏ÔºåÊ≤íÊúâÁâπÊÆäÊïàÊûú
                    break;
            }
        }

        function checkCollisions() {
            // Ê™¢Êü•Áé©ÂÆ∂1ÊíûÂà∞ÈöúÁ§ôÁâ©
            for (let obstacle of obstacles) {
                if (player1.x === obstacle.x && player1.y === obstacle.y) {
                    endGame('Áé©ÂÆ∂‰∫åÁç≤ÂãùÔºÅÁé©ÂÆ∂‰∏ÄÊíûÂà∞ÈöúÁ§ôÁâ©‰∫ÜÔºÅ', 'Áé©ÂÆ∂‰∏Ä');
                    return;
                }
            }

            // Ê™¢Êü•Áé©ÂÆ∂2ÊíûÂà∞ÈöúÁ§ôÁâ©
            for (let obstacle of obstacles) {
                if (player2.x === obstacle.x && player2.y === obstacle.y) {
                    endGame('Áé©ÂÆ∂‰∏ÄÁç≤ÂãùÔºÅÁé©ÂÆ∂‰∫åÊíûÂà∞ÈöúÁ§ôÁâ©‰∫ÜÔºÅ', 'Áé©ÂÆ∂‰∫å');
                    return;
                }
            }

            // Ê™¢Êü•Áé©ÂÆ∂1Ëá™Êíû
            for (let segment of player1.tail) {
                if (player1.x === segment.x && player1.y === segment.y) {
                    endGame('Áé©ÂÆ∂‰∫åÁç≤ÂãùÔºÅÁé©ÂÆ∂‰∏ÄÊíûÂà∞Ëá™Â∑±‰∫ÜÔºÅ', 'Áé©ÂÆ∂‰∏Ä');
                    return;
                }
            }

            // Ê™¢Êü•Áé©ÂÆ∂2Ëá™Êíû
            for (let segment of player2.tail) {
                if (player2.x === segment.x && player2.y === segment.y) {
                    endGame('Áé©ÂÆ∂‰∏ÄÁç≤ÂãùÔºÅÁé©ÂÆ∂‰∫åÊíûÂà∞Ëá™Â∑±‰∫ÜÔºÅ', 'Áé©ÂÆ∂‰∫å');
                    return;
                }
            }

            // Ê™¢Êü•Áé©ÂÆ∂‰∫íÊíû
            if (player1.x === player2.x && player1.y === player2.y) {
                if (player1.score > player2.score) {
                    endGame('Áé©ÂÆ∂‰∏ÄÁç≤ÂãùÔºÅÂàÜÊï∏ËºÉÈ´òÔºÅ', 'Áé©ÂÆ∂‰∫å');
                } else if (player2.score > player1.score) {
                    endGame('Áé©ÂÆ∂‰∫åÁç≤ÂãùÔºÅÂàÜÊï∏ËºÉÈ´òÔºÅ', 'Áé©ÂÆ∂‰∏Ä');
                } else {
                    endGame('Âπ≥ÊâãÔºÅÂÖ©‰ΩçÁé©ÂÆ∂ÂêåÊôÇÁ¢∞ÊíûÔºÅ', null);
                }
                return;
            }

            // Ê™¢Êü•Áé©ÂÆ∂1ÊíûÂà∞Áé©ÂÆ∂2Ë∫´È´î
            for (let segment of player2.tail) {
                if (player1.x === segment.x && player1.y === segment.y) {
                    endGame('Áé©ÂÆ∂‰∫åÁç≤ÂãùÔºÅÁé©ÂÆ∂‰∏ÄÊíûÂà∞Áé©ÂÆ∂‰∫åÔºÅ', 'Áé©ÂÆ∂‰∏Ä');
                    return;
                }
            }

            // Ê™¢Êü•Áé©ÂÆ∂2ÊíûÂà∞Áé©ÂÆ∂1Ë∫´È´î
            for (let segment of player1.tail) {
                if (player2.x === segment.x && player2.y === segment.y) {
                    endGame('Áé©ÂÆ∂‰∏ÄÁç≤ÂãùÔºÅÁé©ÂÆ∂‰∫åÊíûÂà∞Áé©ÂÆ∂‰∏ÄÔºÅ', 'Áé©ÂÆ∂‰∫å');
                    return;
                }
            }
        }



        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            gamePaused = false;
            gameStatus.textContent = 'ÈÅäÊà≤ÈÄ≤Ë°å‰∏≠...';
            winnerDisplay.innerHTML = '';
            
            // ÁîüÊàêÈöúÁ§ôÁâ©ÂíåÈ£üÁâ©
            generateObstacles();
            generateFood();
            
            gameLoop = setInterval(updateGame, 150);
            
            startBtn.textContent = 'ÈÅäÊà≤‰∏≠';
            startBtn.disabled = true;
            pauseBtn.disabled = false;
        }

        function pauseGame() {
            if (!gameRunning) return;
            
            gamePaused = !gamePaused;
            
            if (gamePaused) {
                gameStatus.textContent = 'ÈÅäÊà≤Â∑≤Êö´ÂÅú';
                pauseBtn.textContent = 'ÁπºÁ∫å';
            } else {
                gameStatus.textContent = 'ÈÅäÊà≤ÈÄ≤Ë°å‰∏≠...';
                pauseBtn.textContent = 'Êö´ÂÅú';
            }
        }

        function resetGame() {
            gameRunning = false;
            gamePaused = false;
            clearInterval(gameLoop);
            
            // ÈáçÁΩÆÁé©ÂÆ∂ÁãÄÊÖã
            player1 = {
                x: 10,
                y: 10,
                dx: 0,
                dy: 0,
                tail: [],
                score: 0,
                color: '#f1c40f'
            };
            
            player2 = {
                x: 15,
                y: 15,
                dx: 0,
                dy: 0,
                tail: [],
                score: 0,
                color: '#e74c3c'
            };
            
            // ÈáçÁΩÆÁé©ÂÆ∂ÊïàÊûú
            playerEffects = {
                player1: { speed: false, speedTimer: 0 },
                player2: { speed: false, speedTimer: 0 }
            };
            
            // Ê∏ÖÁ©∫È£üÁâ©ÂíåÈöúÁ§ôÁâ©
            foods = [];
            obstacles = [];
            
            scorePlayer1.textContent = '0';
            scorePlayer2.textContent = '0';
            gameStatus.textContent = 'Ê∫ñÂÇôÈñãÂßãÈÅäÊà≤ÔºÅ';
            winnerDisplay.innerHTML = '';
            
            startBtn.textContent = 'ÈñãÂßãÈÅäÊà≤';
            startBtn.disabled = false;
            pauseBtn.textContent = 'Êö´ÂÅú';
            pauseBtn.disabled = true;
            
            drawGame();
        }

        function endGame(message, loser) {
            gameRunning = false;
            clearInterval(gameLoop);
            
            gameStatus.textContent = 'ÈÅäÊà≤ÁµêÊùü';
            winnerDisplay.innerHTML = `<div class="winner-announcement">${message}</div>`;
            
            startBtn.textContent = 'ÈñãÂßãÈÅäÊà≤';
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            // Â¶ÇÊûúÊúâËº∏ÂÆ∂ÔºåÈ°ØÁ§∫Êá≤ÁΩ∞ÂΩàÁ™ó
            if (loser) {
                setTimeout(() => {
                    showPunishmentModal(loser);
                }, 1000); // Âª∂ÈÅ≤1ÁßíÈ°ØÁ§∫Êá≤ÁΩ∞ÂΩàÁ™ó
            }
        }

        // ÈçµÁõ§ÊéßÂà∂
        document.addEventListener('keydown', (e) => {
            if (!gameRunning || gamePaused) return;
            
            switch(e.key) {
                // Áé©ÂÆ∂1 (WASD)
                case 'w':
                case 'W':
                    if (player1.dy !== 1) {
                        player1.dx = 0;
                        player1.dy = -1;
                    }
                    break;
                case 's':
                case 'S':
                    if (player1.dy !== -1) {
                        player1.dx = 0;
                        player1.dy = 1;
                    }
                    break;
                case 'a':
                case 'A':
                    if (player1.dx !== 1) {
                        player1.dx = -1;
                        player1.dy = 0;
                    }
                    break;
                case 'd':
                case 'D':
                    if (player1.dx !== -1) {
                        player1.dx = 1;
                        player1.dy = 0;
                    }
                    break;
                
                // Áé©ÂÆ∂2 (ÊñπÂêëÈçµ)
                case 'ArrowUp':
                    if (player2.dy !== 1) {
                        player2.dx = 0;
                        player2.dy = -1;
                    }
                    break;
                case 'ArrowDown':
                    if (player2.dy !== -1) {
                        player2.dx = 0;
                        player2.dy = 1;
                    }
                    break;
                case 'ArrowLeft':
                    if (player2.dx !== 1) {
                        player2.dx = -1;
                        player2.dy = 0;
                    }
                    break;
                case 'ArrowRight':
                    if (player2.dx !== -1) {
                        player2.dx = 1;
                        player2.dy = 0;
                    }
                    break;
            }
        });

        // Ëß∏ÊéßÊéßÂà∂
        document.querySelectorAll('.control-button').forEach(button => {
            button.addEventListener('click', () => {
                if (!gameRunning || gamePaused) return;
                
                const player = button.dataset.player === '1' ? player1 : player2;
                const direction = button.dataset.direction;
                
                switch(direction) {
                    case 'up':
                        if (player.dy !== 1) {
                            player.dx = 0;
                            player.dy = -1;
                        }
                        break;
                    case 'down':
                        if (player.dy !== -1) {
                            player.dx = 0;
                            player.dy = 1;
                        }
                        break;
                    case 'left':
                        if (player.dx !== 1) {
                            player.dx = -1;
                            player.dy = 0;
                        }
                        break;
                    case 'right':
                        if (player.dx !== -1) {
                            player.dx = 1;
                            player.dy = 0;
                        }
                        break;
                }
            });
        });

        // ÊåâÈàï‰∫ã‰ª∂
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', pauseGame);
        resetBtn.addEventListener('click', resetGame);

        // ÂàùÂßãÂåñÈÅäÊà≤
        resetGame();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9682a9d3e00aa3ac',t:'MTc1NDAyMzI4OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
